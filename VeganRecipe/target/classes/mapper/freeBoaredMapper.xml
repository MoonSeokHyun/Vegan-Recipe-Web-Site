<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.vegan.recipe.freeBoard.mapper.IfreeBoardMapper">
     
     

	<sql id="search">
		<if test="condition == 'freeboard_title'">
			WHERE freeboard_title LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="condition == 'freeboard_content'">
			WHERE freeboard_content LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="condition == 'freeboard_writer'">
			WHERE freeboard_writer LIKE CONCAT('%',#{keyword},'%')
		</if>
	</sql>
	
     
     <!-- 글 등록 조회수랑 라이크는 0으로 세팅! -->
     <insert id="insertFreeboard">
     	insert into Vegan_freeBoard(
     	freeboard_no,
     	freeboard_title,
     	freeboard_writer,
     	freeboard_content,
     	freeboard_hit,
     	freeboard_like
     	) values ((select * from (select max(freeboard_no)+1 from vegan_freeboard) next ),
     	#{freeboard_title},#{freeboard_writer},#{freeboard_content},0,0)
     </insert>
     
     
     <!-- 글목록 나중에 페이징 이랑 검색 할꺼임 -->
     
     <select id="getFreeBoard" resultType="com.vegan.recipe.freeBoard.freeboardVO">

     	select * from Vegan_freeBoard 
     	<include refid="search" />
     	order by freeboard_no desc
     	limit #{pagecnt} ,  #{countPerPage}

     	
     </select>
     
          <select id="freeDetail" resultType="com.vegan.recipe.freeBoard.freeboardVO">
     	select * from Vegan_freeBoard where freeboard_no = #{freeboard_no} 
     </select>
     
     <!-- 토탈 -->
     	<select id="getTotal" resultType="int">
		SELECT COUNT(*)
		FROM Vegan_freeBoard
		<include refid="search" />
	</select>
	
	<!-- 조회수 -->
	
	<update id="hit">
	 update Vegan_freeBoard 
      set freeboard_hit = freeboard_hit + 1
      where freeboard_no = #{freeboard_no}
	</update>
	
	<select id="comCNT" resultType="com.vegan.recipe.freeBoard.freeboardVO" >
		select u.*, (select count(*) from vegan_comment where bno = #{freeboard_no} ) as com_cnt  
		from vegan_freeboard u where freeboard_no = #{freeboard_no}; 
	</select>
  </mapper>
  
  
  
  
  
  
  
  
  
  
  